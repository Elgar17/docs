(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{470:function(_,v,t){"use strict";t.r(v);var e=t(42),o=Object(e.a)({},(function(){var _=this,v=_.$createElement,t=_._self._c||v;return t("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[t("h1",{attrs:{id:"浏览器缓存机制-http-缓存机制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存机制-http-缓存机制"}},[_._v("#")]),_._v(" 浏览器缓存机制（HTTP 缓存机制）")]),_._v(" "),t("p",[_._v("说起浏览器缓存可能会想到 "),t("code",[_._v("coockie")]),_._v(", "),t("code",[_._v("localStorage")]),_._v(" 等。这里会介绍的缓存是指 HTTP缓存机制。")]),_._v(" "),t("p",[_._v("本文内容：")]),_._v(" "),t("ul",[t("li",[_._v("介绍 "),t("code",[_._v("HTTP")]),_._v(" 缓存")]),_._v(" "),t("li",[_._v("强制缓存，"),t("code",[_._v("Expires")]),_._v(" 和 "),t("code",[_._v("Cache-Control")])]),_._v(" "),t("li",[_._v("协商缓存，"),t("code",[_._v("Etag")]),_._v(" 和 "),t("code",[_._v("last-Modified")])])]),_._v(" "),t("h2",{attrs:{id:"_1-概述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-概述"}},[_._v("#")]),_._v(" 1. 概述")]),_._v(" "),t("p",[_._v("先介绍一下，"),t("code",[_._v("HTTP")]),_._v(" 常见状态码")]),_._v(" "),t("ul",[t("li",[_._v("200 - 请求成功")]),_._v(" "),t("li",[_._v("301 - 资源（网页等）被永久转移到其它URL")]),_._v(" "),t("li",[_._v("404 - 请求的资源（网页等）不存在")]),_._v(" "),t("li",[_._v("500 - 内部服务器错误")])]),_._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"left"}},[_._v("状态码")]),_._v(" "),t("th",[_._v("描述")])])]),_._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"left"}},[_._v("1**")]),_._v(" "),t("td",[_._v("信息，请求已经接受，处理中")])]),_._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[_._v("2**")]),_._v(" "),t("td",[_._v("成功， 200")])]),_._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[_._v("3**")]),_._v(" "),t("td",[_._v("重定向，常见301（永久移动），302（临时移动），304（未修改，内容为空）")])]),_._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[_._v("4**")]),_._v(" "),t("td",[_._v("客户端错误，常见 404 （找不到响应文件）")])]),_._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"left"}},[_._v("5**")]),_._v(" "),t("td",[_._v("服务端错误，501（服务器不支持请求的功能)")])])])]),_._v(" "),t("p",[_._v("HTTP缓存简单地说，就是当你两次请求某一个网站时，浏览器第一次请求时，会缓存一些数据，第二次请求同样数据时，直接回复缓存的内容，第二次不会发送 HTTP 请求。")]),_._v(" "),t("p",[_._v("这样第二次请求时的时间会大大缩短，大大提高了用户体验，也节省了宽带。")]),_._v(" "),t("p",[_._v("不过这个过程中会有很多情况，比如，同样的内容，浏览器第一次请求时缓存到本地了，之后服务器改变了这个资源，第二次请求直接返回缓存，这导致用户获取不到最新资源。所以浏览器缓存有一些规则，下面我们深入介绍。")]),_._v(" "),t("h2",{attrs:{id:"_2-发送-http-请求的过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-发送-http-请求的过程"}},[_._v("#")]),_._v(" 2. 发送 HTTP 请求的过程")]),_._v(" "),t("p",[_._v("因为缓存在 HTTP 请求中产生的，所以先分析发送一个 HTTP 请求发送的过程。")]),_._v(" "),t("p",[_._v("发送一个 HTTP 请求：")]),_._v(" "),t("ol",[t("li",[_._v("在浏览器本地查找是否存在该资源")]),_._v(" "),t("li",[_._v("如果不存在，向服务器发送 http 请求")]),_._v(" "),t("li",[_._v("如果过存在，返回本地的资源，并该资源缓存到本地")])]),_._v(" "),t("p",[t("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30SJ6B9RIagMBY6Bc7S2vkKSu3.png",alt:"图面"}})]),_._v(" "),t("p",[_._v("在这缓存过程分为两种，"),t("strong",[_._v("强制缓存")]),_._v("和"),t("strong",[_._v("协商缓存")]),_._v("。下面具体介绍。")]),_._v(" "),t("h2",{attrs:{id:"_3-强制缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-强制缓存"}},[_._v("#")]),_._v(" 3. 强制缓存")]),_._v(" "),t("p",[_._v("强制缓存是指，从浏览器的缓存中查找数据，有三种情况：")]),_._v(" "),t("ul",[t("li",[_._v("查找缓存，不存在，向服务器发送请求")]),_._v(" "),t("li",[_._v("查找缓存，过期了，向服务器发送请求")]),_._v(" "),t("li",[_._v("查找缓存，没有过期，返回缓存内容")])]),_._v(" "),t("p",[_._v("怎么知道过期的呢，又怎么缓存呢？")]),_._v(" "),t("p",[_._v("服务器给浏览器发送资源时，给资源标注好，这个数据需不需要缓存到本地，这个标注是浏览器头部"),t("strong",[_._v("Expires 和 Cache-Control")]),_._v("。")]),_._v(" "),t("p",[_._v("（1）Expires")]),_._v(" "),t("p",[t("code",[_._v("Expires")]),_._v(" 的值为"),t("strong",[_._v("缓存过期的时间")]),_._v("，是 "),t("code",[_._v("HTTP/1.0")]),_._v(" 控制网页缓存的字段。比如，2021.10.1 00:00 类似这种，如果第二次请求该资源，并且10月1号前，那么直接返回本地缓存的内容，说明没有过期。")]),_._v(" "),t("p",[_._v("在 "),t("code",[_._v("HTTP/1.1")]),_._v(" 中 "),t("code",[_._v("Expires")]),_._v(" 被 "),t("code",[_._v("Cache-Control")]),_._v(" 代替，原因是本地时间可能会有错误。")]),_._v(" "),t("p",[_._v("（2）Cache-Control")]),_._v(" "),t("p",[_._v("在 "),t("code",[_._v("HTTP/1.1")]),_._v(" 中，缓存规则是 "),t("code",[_._v("Cache-Control")]),_._v(" 的字段，它有以下字段：")]),_._v(" "),t("ul",[t("li",[_._v("public：可缓存所有内容，客户端和代理服务器")]),_._v(" "),t("li",[_._v("private：可缓存所有内容，只有客户端")]),_._v(" "),t("li",[_._v("no-cache：客户端缓存，是否使用协商缓存来验证")]),_._v(" "),t("li",[_._v("no-store：不会缓存，不使用强制缓存，协商缓存")]),_._v(" "),t("li",[_._v("max-age=???：缓存内容 ??? 后失效")])]),_._v(" "),t("p",[t("code",[_._v("Expires")]),_._v(" 和 "),t("code",[_._v("Cache-Control")]),_._v(" 两个字段同时存在时，优先使用 "),t("code",[_._v("Cache-Control")]),_._v("。")]),_._v(" "),t("h2",{attrs:{id:"_4-协商缓存"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-协商缓存"}},[_._v("#")]),_._v(" 4. 协商缓存")]),_._v(" "),t("p",[_._v("协商缓存是，本地缓存过期，向服务器发送 "),t("code",[_._v("HTTP")]),_._v(" 请求，这是服务器可能返回两种状态码："),t("code",[_._v("200")]),_._v(" 或 "),t("code",[_._v("302")]),_._v("，下面分别讨论两种情况：")]),_._v(" "),t("p",[_._v("（1）302")]),_._v(" "),t("p",[_._v("如果请求某个资源返回 "),t("code",[_._v("302")]),_._v(" 状态码，说明协商缓存生效。具体过程如下：")]),_._v(" "),t("ul",[t("li",[_._v("发送 "),t("code",[_._v("HTTP")]),_._v(" 请求，先去找本地缓存")]),_._v(" "),t("li",[_._v("本地缓存中的内容过期了，返回过期的标识")]),_._v(" "),t("li",[_._v("向服务器发送请求，携带过期标识")]),_._v(" "),t("li",[_._v("服务器检查，看这段时间内资源没有变化，返回 "),t("code",[_._v("302")]),_._v("，"),t("strong",[_._v("没有内容")])]),_._v(" "),t("li",[_._v("浏览器使用本地缓存的内容。")])]),_._v(" "),t("p",[t("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30OK3o7ZD3zsTVJVE0qwrTs_97.png",alt:"302"}})]),_._v(" "),t("p",[_._v("（2）200")]),_._v(" "),t("p",[_._v("整个过程跟 "),t("code",[_._v("301")]),_._v(" 差不太多，具体过程如下：")]),_._v(" "),t("ul",[t("li",[_._v("发送 "),t("code",[_._v("HTTP")]),_._v(" 请求，先去找本地缓存")]),_._v(" "),t("li",[_._v("本地缓存中的内容过期了，返回过期的标识")]),_._v(" "),t("li",[_._v("向服务器发送请求，携带过期标识")]),_._v(" "),t("li",[_._v("服务器检查，看这段时间内资源有变化，返回 "),t("code",[_._v("200")]),_._v("，"),t("strong",[_._v("内容携带新的资源")])]),_._v(" "),t("li",[_._v("浏览器使用本地缓存的内容。")])]),_._v(" "),t("p",[t("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30iC1c-X0hWv-XnBhG0MyFpesx.png",alt:"200"}})]),_._v(" "),t("p",[_._v("协商缓存控制的字段有一下几个，我们已经知道，需要向服务器发送本地缓存的时间等信息：")]),_._v(" "),t("p",[_._v("如果服务器查看请求中有 "),t("code",[_._v("If-None-Match")]),_._v(" ，与自己生成的 "),t("code",[_._v("Etag")]),_._v(" 比较，如果相同，说明没有变化，返回 "),t("code",[_._v("302")]),_._v("，不相同重新发送，返回 "),t("code",[_._v("200")])]),_._v(" "),t("ul",[t("li",[t("code",[_._v("Etag")]),_._v("：服务器 => 浏览器，返回当前资源文件的一个唯一标识(由服务器生成)")]),_._v(" "),t("li",[t("code",[_._v("If-None-Match")]),_._v("：浏览器=>服务器，再次请求时，返回 "),t("code",[_._v("Etag")])])]),_._v(" "),t("p",[_._v("如果服务器查看请求中有 "),t("code",[_._v("last-Modified")]),_._v(" ，与自己生成的 "),t("code",[_._v("If-Modified-Since")]),_._v(" 比较，如果相同，说明没有变化，返回 "),t("code",[_._v("302")]),_._v("，不相同重新发送，返回 "),t("code",[_._v("200")])]),_._v(" "),t("ul",[t("li",[t("code",[_._v("last-Modified")]),_._v("：服务器 => 浏览器，返回该资源文件在服务器最后被修改的时间")]),_._v(" "),t("li",[t("code",[_._v("If-Modified-Since")]),_._v("： 浏览器=>服务器，再次请求时，返回 "),t("code",[_._v("last-modified")])])]),_._v(" "),t("p",[_._v("需要注意的是，"),t("code",[_._v("Etag")]),_._v(" 的优先级高于 "),t("code",[_._v("last-Modified")]),_._v("。")]),_._v(" "),t("h2",{attrs:{id:"_5-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-总结"}},[_._v("#")]),_._v(" 5. 总结")]),_._v(" "),t("p",[t("img",{attrs:{src:"https://www.mwcxs.top/static/upload/pics/2019/1/30SX0D2hqApuJ7Z44y609Z3RKp.png",alt:"总结"}})]),_._v(" "),t("p",[_._v("参考：")]),_._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://juejin.cn/post/6844903512946507790",target:"_blank",rel:"noopener noreferrer"}},[_._v("理解浏览器缓存以及304状态码"),t("OutboundLink")],1)]),_._v(" "),t("li",[t("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified",target:"_blank",rel:"noopener noreferrer"}},[_._v("MDN"),t("OutboundLink")],1)]),_._v(" "),t("li",[t("a",{attrs:{href:"https://www.cnblogs.com/chengxs/p/10396066.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("彻底理解浏览器缓存机制"),t("OutboundLink")],1)])]),_._v(" "),t("comment-comment")],1)}),[],!1,null,null,null);v.default=o.exports}}]);